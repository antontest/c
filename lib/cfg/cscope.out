cscope 15 $HOME/working/program/lib/cfg -q 0000000076 0000009070
	@cfg.c

1 
	~"cfg.h
"

8 
	$l_Œim
(*
s
)

10 *
p
 = 
s
, *
q
 = s;;

13 ià(
s
 =ð
NULL
)  ;

16 *
p
 == ' ')…++;

17 (*
q
++ = *
p
++) != '\0') ;

18 
	}
}

25 
	$r_Œim
(*
s
)

27 *
p
 = 
s
;

28 ià(
p
 =ð
NULL
)  ;

35 *
p
 != '\0')…++;

36 --
p
 !ð
s
 && *p == ' ') ;

37 *(++
p
) = '\0';

38 
	}
}

46 
	$mid_Œim
(*
s
)

48 *
a
 = 
s
, *
b
 = s;

49 ià(
a
 =ð
NULL
) ;

52 *
a
 != '\0' && *a == ' ')‡++;

53 *
b
 = *
a
;

56 *(++
a
) != '\0') {

57 ià(*
a
 !ð' ' || *
b
 != ' ')

58 *(++
b
èð*
a
;

62 ià(*
b
 == ' ') *b = '\0';

63 *(++
b
) = '\0';

64 
	}
}

71 
	$a_Œim
(*
s
)

73 *
b
 = 
s
, *
p
 = s;

74 ià(
p
 =ð
NULL
)  ;

77 *
p
 != '\0') {

78 ià(*
p
 !ð' 'è*
b
++ = *p;

79 
p
++;

81 *
b
 = '\0';

82 
	}
}

91 
	$cfg_rm_comm’t
(*
lše
, cÚ¡ *
comm_ch¬
, **
comm’t
)

93 *
p
 = 
lše
;

94 ià(
lše
 =ð
NULL
) ;

96 *
p
 !ð'\0' && *°!ð
comm_ch¬
[0])…++;

98 *
p
 = '\0';

99 ià(
comm’t
 !ð
NULL
è*comm’ˆð++
p
;

102 
	}
}

114 
	$cfg_lše_¥l™
(*
lše
, cÚ¡ *
¥l™
, **
Çme
, **
v®ue
)

116 
ch
 = 
¥l™
[0];

117 *
p
 = 
lše
;

120 ià(
p
 =ð
NULL
 || 
¥l™
 == NULL)  -1;

126 *
p
 !ð'\0' && *°!ð
ch
)…++;

129 ià(*
p
 == '\0')  -1;

132 *
Çme
 = 
lše
;

133 *
p
 = '\0';

134 *
v®ue
 = ++
p
;

136  (
p
 - 
lše
 - 1);

137 
	}
}

149 
	$cfg_v®ue_gaš
(cÚ¡ *
key_Çme
, cÚ¡ *
¥l™
, 
v®ue
[], cÚ¡ *
·th
)

151 
FILE
 *
å
 = 
NULL
;

152 *
k_Çme
 = 
NULL
;

153 *
k_v®ue
 = 
NULL
;

154 
buf
[1024] = {0};

155 
size
 = (
buf
);

156 
Ën
 = 0;

157 
¹
 = -1;

160 ià(
·th
 =ð
NULL
 || 
key_Çme
 =ðNULL || 
¥l™
 =ðNULLè
ä“
;

163 ià((
å
 = 
	`fÝ’
(
·th
, "r")è=ð
NULL
è
ä“
;

166 
	`fg‘s
(
buf
, 
size
, 
å
è!ð
NULL
) {

169 ià(
	`cfg_lše_¥l™
(
buf
, 
¥l™
, &
k_Çme
, &
k_v®ue
) < 0)

172 
	`mid_Œim
(
k_Çme
);

173 ià(
	`¡ºcmp
(
k_Çme
, 
key_Çme
, 
	`¡¾’
(k_name)))

177 ià(
v®ue
 =ð
NULL
) ;

178 
Ën
 = 
	`¡¾’
(
k_v®ue
);

179 ià(
k_v®ue
[
Ën
 - 1] == '\n' || k_value[len - 1] =='\t')

180 
k_v®ue
[
Ën
 - 1] = '\0';

183 
	`¡rýy
(
v®ue
, 
k_v®ue
);

184 
¹
 = 0;

189 
ä“
:

191 ià(
å
 !ð
NULL
è
	`fþo£
(fp);

192 
å
 = 
NULL
;

194  
¹
;

195 
	}
}

207 
	$cfg_v®ue_£t
(cÚ¡ *
key_Çme
, cÚ¡ *
¥l™
, cÚ¡ *
v®ue
, cÚ¡ *
·th
)

209 
FILE
 *
å
 = 
NULL
;

210 
buf
[1024] = {0};

211 *
sum_buf
 = 
NULL
;

212 *
k_Çme
 = 
NULL
;

213 *
k_v®ue
 = 
NULL
;

214 
size
 = (
buf
);

215 
cfg_size
 = 0;

216 
¹
 = -1;

217 
is_£t
 = 0;

220 ià(
·th
 =ð
NULL
 || 
key_Çme
 =ðNULL || 
¥l™
 =ðNULL || 
v®ue
 =ðNULLè
ä“
;

223 ià((
å
 = 
	`fÝ’
(
·th
, "r+")è=ð
NULL
è
ä“
;

226 
	`f£ek
(
å
, 0, 
SEEK_END
);

227 
cfg_size
 = 
	`á–l
(
å
);

228 
	`f£ek
(
å
, 0, 
SEEK_SET
);

229 ià(
cfg_size
 < 2è
ä“
;

232 
sum_buf
 = (*)
	`m®loc
(
cfg_size
 + 
	`¡¾’
(
v®ue
) + 1);

233 ià(
sum_buf
 =ð
NULL
è
ä“
;

234 
	`¡rýy
(
sum_buf
, "");

237 
	`fg‘s
(
buf
, 
size
, 
å
è!ð
NULL
) {

239 ià(
	`cfg_lše_¥l™
(
buf
, 
¥l™
, &
k_Çme
, &
k_v®ue
) < 0) {

240 
	`¡rÿt
(
sum_buf
, 
buf
);

245 
	`¡rÿt
(
sum_buf
, 
k_Çme
);

246 
	`¡rÿt
(
sum_buf
, "=");

249 
	`mid_Œim
(
k_Çme
);

250 ià(
	`¡ºcmp
(
k_Çme
, 
key_Çme
, 
	`¡¾’
(k_name))){

251 
	`¡rÿt
(
sum_buf
, 
k_v®ue
);

256 ià(!
	`¡ºcmp
(
k_v®ue
, 
v®ue
, 
	`¡¾’
(k_value)))

260 
	`¡rÿt
(
sum_buf
, 
v®ue
);

261 
	`¡rÿt
(
sum_buf
, "\n");

262 
is_£t
 = 1;

268 ià(!
is_£t
è
ä“
;

271 
	`fg‘s
(
buf
, 
size
, 
å
è!ð
NULL
) {

272 
	`¡rÿt
(
sum_buf
, 
buf
);

276 ià(
å
 !ð
NULL
è
	`fþo£
(fp);

277 
å
 = 
NULL
;

278 ià((
å
 = 
	`fÝ’
(
·th
, "w")è=ð
NULL
è
ä“
;

279 
	`åuts
(
sum_buf
, 
å
);

280 
¹
 = 0;

282 
ä“
:

284 ià(
å
 !ð
NULL
è
	`fþo£
(fp);

285 
å
 = 
NULL
;

288 ià(
sum_buf
 !ð
NULL
è
	`ä“
(sum_buf);

289 
sum_buf
 = 
NULL
;

291  
¹
;

292 
	}
}

305 
	$ši_v®ue_gaš
(cÚ¡ *
­p_Çme
, cÚ¡ *
key_Çme
, 
v®ue
[], cÚ¡ *
·th
)

307 
FILE
 *
å
 = 
NULL
;

308 
buf
[1024] = {0};

309 *
­p
 = 
NULL
;

310 *
k_Çme
 = 
NULL
;

311 *
k_v®ue
 = 
NULL
;

312 
size
 = (
buf
);

313 
Ën
 = 0;

314 
¹
 = -1;

317 ià(
·th
 =ð
NULL
 || 
key_Çme
 =ðNULL || 
­p_Çme
 =ðNULLè
ä“
;

320 
­p
 = (*)
	`m®loc
(
	`¡¾’
(
­p_Çme
) + 2 + 1);

321 ià(
­p
 =ð
NULL
è
ä“
;

322 
	`¥rštf
(
­p
, "[%s]", 
­p_Çme
);

323 
	`¡rÿt
(
­p
, "\0");

324 
Ën
 = 
	`¡¾’
(
­p
);

327 ià((
å
 = 
	`fÝ’
(
·th
, "r")è=ð
NULL
è
ä“
;

330 
	`fg‘s
(
buf
, 
size
, 
å
è!ð
NULL
) {

332 
	`l_Œim
(
buf
);

333 ià(
buf
[0] == '#' || buf[0] == ';') ;

336 ià(!
	`¡ºcmp
(
buf
, 
­p
, 
Ën
)) {

342 ià(
	`ãof
(
å
)è
ä“
;

345 
	`fg‘s
(
buf
, 
size
, 
å
è!ð
NULL
) {

347 
	`l_Œim
(
buf
);

348 ià(
buf
[0] == '#' || buf[0] == ';') ;

349 ià(
buf
[0] == '[') ;

352 ià(
	`cfg_lše_¥l™
(
buf
, "=", &
k_Çme
, &
k_v®ue
) < 0)

355 
	`mid_Œim
(
k_Çme
);

356 ià(
	`¡ºcmp
(
k_Çme
, 
key_Çme
, 
	`¡¾’
(k_name)))

360 ià(
v®ue
 =ð
NULL
) ;

361 
Ën
 = 
	`¡¾’
(
k_v®ue
);

362 ià(
k_v®ue
[
Ën
 - 1] == '\n' || k_value[len - 1] =='\t')

363 
k_v®ue
[
Ën
 - 1] = '\0';

366 
	`¡rýy
(
v®ue
, 
k_v®ue
);

367 
¹
 = 0;

372 
ä“
:

374 ià(
å
 !ð
NULL
è
	`fþo£
(fp);

375 
å
 = 
NULL
;

378 ià(
­p
 !ð
NULL
è
	`ä“
(app);

379 
­p
 = 
NULL
;

381  
¹
;

382 
	}
}

394 
	$ši_v®ue_£t
(cÚ¡ *
­p_Çme
, cÚ¡ *
key_Çme
, cÚ¡ *
v®ue
, cÚ¡ *
·th
)

396 
FILE
 *
å
 = 
NULL
;

397 *
­p
 = 
NULL
;

398 *
k_Çme
 = 
NULL
;

399 *
k_v®ue
 = 
NULL
;

400 
buf
[1024] = {0};

401 *
sum_buf
 = 
NULL
;

402 
size
 = (
buf
);

403 
ši_size
 = 0;

404 
Ën
 = 0;

405 
¹
 = -1;

406 
is_£t
 = 0;

409 ià(
·th
 =ð
NULL
 || 
­p_Çme
 =ðNULLè
ä“
;

412 
­p
 = (*)
	`m®loc
(
	`¡¾’
(
­p_Çme
) + 2 + 1);

413 ià(
­p
 =ð
NULL
è
ä“
;

414 
	`¥rštf
(
­p
, "[%s]", 
­p_Çme
);

415 
	`¡rÿt
(
­p
, "\0");

416 
Ën
 = 
	`¡¾’
(
­p
);

419 ià((
å
 = 
	`fÝ’
(
·th
, "r")è=ð
NULL
è
ä“
;

422 
	`f£ek
(
å
, 0, 
SEEK_END
);

423 
ši_size
 = 
	`á–l
(
å
);

424 
	`f£ek
(
å
, 0, 
SEEK_SET
);

427 
sum_buf
 = (*)
	`m®loc
(
ši_size
 + 
Ën
 + \

428 (
key_Çme
 !ð
NULL
 ? 
	`¡¾’
(key_name) : 0) + \

429 (
v®ue
 !ð
NULL
 ? 
	`¡¾’
(value) : 0) + 1);

430 ià(
sum_buf
 =ð
NULL
è
ä“
;

431 
	`¡rýy
(
sum_buf
, "");

434 
	`fg‘s
(
buf
, 
size
, 
å
è!ð
NULL
) {

436 
	`l_Œim
(
buf
);

437 ià(
buf
[0] == '#' || buf[0] == ';') ;

440 ià(!
	`¡ºcmp
(
buf
, 
­p
, 
Ën
)) {

444 
	`¡rÿt
(
sum_buf
, 
buf
);

448 ià(!
	`ãof
(
å
)) {

450 ià(
key_Çme
 =ð
NULL
) {

451 
	`fg‘s
(
buf
, 
size
, 
å
è!ð
NULL
) {

452 
	`l_Œim
(
buf
);

453 ià(
buf
[0] == '[') ;

456 ià(!
	`ãof
(
å
)è
	`¡rÿt
(
sum_buf
, 
buf
);

457 
»¡
;

460 
	`¡rÿt
(
sum_buf
, 
buf
);

467 ià(
key_Çme
 =ð
NULL
 || 
v®ue
 == NULL) {

468 
ä“
;

471 
	`¡rÿt
(
sum_buf
, 
­p
);

472 
	`¡rÿt
(
sum_buf
, "\n");

475 
	`¡rÿt
(
sum_buf
, 
key_Çme
);

476 
	`¡rÿt
(
sum_buf
, "=");

479 
	`¡rÿt
(
sum_buf
, 
v®ue
);

480 
	`¡rÿt
(
sum_buf
, "\n");

482 
wr™e
;

486 
	`fg‘s
(
buf
, 
size
, 
å
è!ð
NULL
) {

488 
	`l_Œim
(
buf
);

489 ià(
buf
[0] == '#' || buf[0] == ';') {

490 
	`¡rÿt
(
sum_buf
, 
buf
);

493 ià(
buf
[0] == '[') ;

496 ià(
	`cfg_lše_¥l™
(
buf
, "=", &
k_Çme
, &
k_v®ue
) < 0) {

497 
	`¡rÿt
(
sum_buf
, 
buf
);

502 
	`mid_Œim
(
k_Çme
);

503 ià(
	`¡ºcmp
(
k_Çme
, 
key_Çme
, 
	`¡¾’
(k_name))){

504 
	`¡rÿt
(
sum_buf
, 
k_Çme
);

505 
	`¡rÿt
(
sum_buf
, "=");

506 
	`¡rÿt
(
sum_buf
, 
k_v®ue
);

512 ià(
v®ue
 =ð
NULL
) {

513 
is_£t
 = 1;

518 
	`¡rÿt
(
sum_buf
, 
k_Çme
);

519 
	`¡rÿt
(
sum_buf
, "=");

522 ià(!
	`¡ºcmp
(
k_v®ue
, 
v®ue
, 
	`¡¾’
(k_value))) {

523 
is_£t
 = -1;

528 
	`¡rÿt
(
sum_buf
, 
v®ue
);

529 
	`¡rÿt
(
sum_buf
, "\n");

530 
is_£t
 = 1;

536 ià(
is_£t
 =ð0 && 
v®ue
 !ð
NULL
) {

538 
	`¡rÿt
(
sum_buf
, 
key_Çme
);

539 
	`¡rÿt
(
sum_buf
, "=");

542 
	`¡rÿt
(
sum_buf
, 
v®ue
);

543 
	`¡rÿt
(
sum_buf
, "\n");

545 
	`¡rÿt
(
sum_buf
, 
buf
);

548 ià(
is_£t
 =ð-1 || (is_£ˆ=ð0 && 
v®ue
 =ð
NULL
))

549 
ä“
;

552 
»¡
:

553 
	`fg‘s
(
buf
, 
size
, 
å
è!ð
NULL
) {

554 
	`¡rÿt
(
sum_buf
, 
buf
);

558 
wr™e
:

559 ià(
å
 !ð
NULL
è
	`fþo£
(fp);

560 
å
 = 
NULL
;

561 ià((
å
 = 
	`fÝ’
(
·th
, "w")è=ð
NULL
è
ä“
;

562 
	`åuts
(
sum_buf
, 
å
);

563 
¹
 = 0;

565 
ä“
:

567 ià(
å
 !ð
NULL
è
	`fþo£
(fp);

568 
å
 = 
NULL
;

571 ià(
­p
 !ð
NULL
è
	`ä“
(app);

572 
­p
 = 
NULL
;

573 ià(
sum_buf
 !ð
NULL
è
	`ä“
(sum_buf);

574 
sum_buf
 = 
NULL
;

576  
¹
;

577 
	}
}

	@cfg.h

1 #iâdeà
__CFG_H__


2 
	#__CFG_H__


	)

4 
	~<¡dio.h
>

5 
	~<¡dlib.h
>

6 
	~<¡ršg.h
>

7 
	~<uni¡d.h
>

8 
	~<fúŽ.h
>

9 
	~<sys/ty³s.h
>

10 
	~<sys/¡©.h
>

11 
	~<sigÇl.h
>

12 
	~<±h»ad.h
>

13 
	~<£m­hÜe.h
>

14 
	~<¡dboÞ.h
>

15 
	~<sys/sysšfo.h
>

16 
	~<sys/”ºo.h
>

17 
	~<sys/wa™.h
>

18 
	~<sys/£Ëù.h
>

19 
	~<g‘Ýt.h
>

20 
	~<time.h
>

27 
l_Œim
(*
s
);

34 
r_Œim
(*
s
);

42 
mid_Œim
(*
s
);

49 
a_Œim
(*
s
);

61 
cfg_lše_¥l™
(*
lše
, cÚ¡ *
¥l™
, **
Çme
, **
v®ue
);

73 
cfg_v®ue_gaš
(cÚ¡ *
key_Çme
, cÚ¡ *
¥l™
, 
v®ue
[], cÚ¡ *
·th
) ;

85 
cfg_v®ue_£t
(cÚ¡ *
key_Çme
, cÚ¡ *
¥l™
, cÚ¡ *
v®ue
, cÚ¡ *
·th
);

97 
ši_v®ue_gaš
(cÚ¡ *
­p_Çme
, cÚ¡ *
key_Çme
, 
v®ue
[], cÚ¡ *
·th
);

109 
ši_v®ue_£t
(cÚ¡ *
­p_Çme
, cÚ¡ *
key_Çme
, cÚ¡ *
v®ue
, cÚ¡ *
·th
);

	@
1
.
0
2
12
cfg.c
cfg.h
