cscope 15 $HOME/working/program/c/socket/test -q 0000000387 0000026088
	@cli/cli.c

4 
	~<¡dio.h
>

5 
	~<¡dlib.h
>

6 
	~<¡ršg.h
>

7 
	~<uni¡d.h
>

8 
	~<sock‘_ba£.h
>

17 
	$maš
(
agrc
, *
agrv
[])

19 
¹
 = 0;

20 
fd
 = -1;

21 
buf
[128] = {0};

22 
sockaddr_š
 
addr
 = {0};

24 ià((
fd
 = 
	`š‘_sock‘_¡¬tup
(
SOCK_STREAM
, \

25 &
addr
, "127.0.0.1", 5001, 0)) == -1)

28 
	`sock‘_cÚÃù
(
fd
, &
addr
);

29 
	`sock‘_£nd
(
fd
, "hi,ser!", 8);

30 
	`sock‘_»cv
(
fd
, 
buf
, (buf));

31 
	`´štf
("šfo: %s\n", 
buf
);

34  
¹
;

35 
	}
}

	@socket_base.c

1 
	~"sock‘_ba£.h
"

2 
	#c_·th
 "../c"

	)

4 
	$maš
(
¬gc
, *
¬gv
[])

6 
fd
 = -1;

7 
şifd
 = -1;

8 
Ën
 = 0;

9 
buf
[128] = {0};

10 
sockaddr_un
 
addr
 = {0};

12 ià((
fd
 = 
	`¡¬tup_loÿl_ş›Á
(
SOCK_DGRAM
, &
addr
, 
c_·th
)) == -1)

15 
	`sock‘_cÚÃù
(
fd
, &
addr
);

16 
	`´štf
("connect succ\n");

17 
	`sock‘_£nd
(
fd
, "hi, ser!", ("hi, ser!"));

18 (
Ën
 = 
	`sock‘_»cv
(
şifd
, 
buf
, (buf))))

20 ià(
Ën
 <= 0) ;

21 
	`´štf
("Ën: %d, info: %s\n", 
Ën
, 
buf
);

23 
	`sock‘_£nd
(
şifd
, "hi", 3);

27 
	}
}

35 
	$”rÜ_d›
(cÚ¡ *
sc
)

37 
	`³¼Ü
(
sc
);

38 
	`ex™
(1);

39 
	}
}

53 
	$sock‘_ü—‹
(
domaš
, 
ty³
)

55 
fd
 = 
	`sock‘
(
domaš
, 
ty³
, 0);

56 ià(
fd
 =ğ-1è
	`”rÜ_d›
("socket");

57  
fd
;

58 
	}
}

67 
	$š‘_addr_š™
(
sockaddr_š
 *
addr
, cÚ¡ *

, 
u_shÜt
 
pÜt
)

72 
addr
->
sš_çmy
 = 
AF_INET
;

73 ià(

 =ğ
NULL
è
addr
->
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

74 
addr
->
sš_addr
.
s_addr
 = 
	`š‘_addr
(

);

75 
addr
->
sš_pÜt
 = 
	`htÚs
(
pÜt
);

78 
	}
}

86 
	$loÿl_addr_š™
(
sockaddr_un
 *
addr
, cÚ¡ *
·th
)

90 ià(
·th
 =ğ
NULL
)

92 
	`´štf
("AF_UNIX…ath can't be NULL.\n");

93 
	`ex™
(1);

99 
	`mem£t
(
addr
, 0, (
sockaddr_un
));

100 
addr
->
sun_çmy
 = 
AF_UNIX
;

101 
	`¡ºıy
(
addr
->
sun_·th
, 
·th
, (addr->sun_path));

102 
addr
->
sun_·th
[(addr->sun_path) - 1] = '\0';

106 
	}
}

116 
	$sock‘_bšd
(
fd
, 
sockaddr
 *
addr
)

118 
addr_Ën
 = (
sockaddr
);

121 ià(
	`bšd
(
fd
,(
sockaddr
 *)
addr
, 
addr_Ën
) < 0)

122 
	`”rÜ_d›
("bind");

125 
	}
}

135 
	$sock‘_li¡’
(
fd
, 
backlog
)

137 ià(
	`li¡’
(
fd
, 
backlog
è< 0è
	`”rÜ_d›
("listen");

140 
	}
}

153 
¡¬tup_š‘_£rv”
(
ty³
, cÚ¡ *

, \

154 
u_shÜt
 
pÜt
)

156 
	gfd
 = -1;

157 
sockaddr_š
 
	gaddr
 = {0};

160 
	gfd
 = 
sock‘_ü—‹
(
AF_INET
, 
ty³
);

161 
make_li¡’_sock‘_»u£abË
(
fd
);

164 
š‘_addr_š™
(&
addr
, 

, 
pÜt
);

167 
sock‘_bšd
(
fd
, (
sockaddr
 *)&
addr
);

170 ià(
	gty³
 =ğ
SOCK_STREAM
è
sock‘_li¡’
(
fd
, 5);

172  
	gfd
;

186 
¡¬tup_š‘_ş›Á
(
ty³
, 
sockaddr_š
 *
addr
, \

187 cÚ¡ *

, 
u_shÜt
 
pÜt
)

191 ià(
	gaddr
 =ğ
NULL
)

193 
årštf
(
¡d”r
, "%s", "struct sockaddr_in cannot be NULL\n");

194 
ex™
(1);

196 ià(
	g
 !ğ
NULL
)

197 
š‘_addr_š™
(
addr
, 

, 
pÜt
);

198 
š‘_addr_š™
(
addr
, "127.0.0.1", 
pÜt
);

201  
sock‘_ü—‹
(
AF_INET
, 
ty³
);

215 
	$¡¬tup_loÿl_£rv”
(
ty³
, cÚ¡ *
·th
)

217 
fd
 = -1;

218 
sockaddr_un
 
addr
 = {0};

221 
	`loÿl_addr_š™
(&
addr
, 
·th
);

224 
fd
 = 
	`sock‘_ü—‹
(
AF_UNIX
, 
ty³
);

225 
	`make_li¡’_sock‘_»u£abË
(
fd
);

228 
	`sock‘_bšd
(
fd
, (
sockaddr
 *)&
addr
);

229 ià(
ty³
 =ğ
SOCK_STREAM
è
	`sock‘_li¡’
(
fd
, 5);

231  
fd
;

232 
	}
}

243 
	$¡¬tup_loÿl_ş›Á
(
ty³
, 
sockaddr_un
 *
addr
, cÚ¡ *
·th
)

245 ià(
addr
 =ğ
NULL
)

247 
	`årštf
(
¡d”r
, "addr cannot be NULL\n");

248 
	`ex™
(1);

252 
	`loÿl_addr_š™
(
addr
, 
·th
);

255  
	`sock‘_ü—‹
(
AF_UNIX
, 
ty³
);

256 
	}
}

265 
	$sock‘_acû±
(
fd
)

267 
sockaddr
 
şi_addr
;

268 
sockËn_t
 
Ën
 = (
sockaddr
);

270  
	`acû±
(
fd
, &
şi_addr
, &
Ën
);

271 
	}
}

281 
	$sock‘_cÚÃù
(
fd
, *
şi_addr
)

283  
	`cÚÃù
(
fd
, (
sockaddr
 *)
şi_addr
, (sockaddr));

284 
	}
}

295 
	$sock‘_time_cÚÃù
(
fd
, *
şi_addr
, 
tm_ms
)

297 
timev®
 
tv
 = {0};

298 
fd_£t
 
wfd
;

299 
¹
 = -1;

300 
š‹rv®
 = 100;

302 ià(
fd
 < 0)  -1;

305 
	`make_sock‘_nÚblock
(
fd
);

311 
	`FD_ZERO
(&
wfd
);

312 
	`FD_SET
(
fd
, &
wfd
);

315 
tv
.
tv_£c
 = 0;

316 
tv
.
tv_u£c
 = 1000 * 
š‹rv®
;

319 
¹
 = 
	`cÚÃù
(
fd
, (
sockaddr
 *)
şi_addr
, (sockaddr));

320 ià(
¹
 =ğ0 || 
”ºo
 !ğ
EINPROGRESS
) ;

323 ià(
	`£Ëù
(
fd
 + 1, 
NULL
, &
wfd
, NULL, &
tv
) > 0)

325 ià(
	`FD_ISSET
(
fd
, &
wfd
))

327 ià(!
	`g‘sockİt
(
fd
, 
SOL_SOCKET
, 
SO_ERROR
, 
NULL
, NULL))

329 
¹
 = 0;

336 
tm_ms
 -ğ
š‹rv®
;

337 ià(
tm_ms
 <= 0)

339 
¹
 = -1;

345 ià(
¹
 < 0è
	`şo£
(
fd
);

347  
¹
;

348 
	}
}

357 
	$sock‘_şo£
(
fd
)

359  
	`şo£
(
fd
);

360 
	}
}

376 
	$sock‘_£nd
(
fd
, *
buf
, 
size
)

378  
	`£nd
(
fd
, 
buf
, 
size
, 0);

379 
	}
}

391 
	$sock‘_time_£nd
(
fd
, *
buf
, 
size
, 
time_ms
)

393 
¹
 = -1;

395 
	`make_sock‘_£nd_timeout
(
fd
, 
time_ms
);

396 
¹
 = 
	`£nd
(
fd
, 
buf
, 
size
, 0);

397 
	`make_sock‘_£nd_timeout
(
fd
, 0);

399  
¹
;

400 
	}
}

417 
	$sock‘_£ndto
(
fd
, *
buf
, 
size
, cÚ¡ *

, 
pÜt
)

419 
sockaddr_š
 
addr
 = {0};

420 
Ën
 = 0;

422 ià(
fd
 < 0)  -1;

424 
addr
.
sš_çmy
 = 
AF_INET
;

425 ià(

 !ğ
NULL
)

426 
addr
.
sš_addr
.
s_addr
 = 
	`š‘_addr
(

);

428 
addr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

429 
addr
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

431 
Ën
 = (
addr
);

432  
	`£ndto
(
fd
, 
buf
, 
size
, 0, (
sockaddr
 *)&
addr
, (
sockËn_t
)
Ën
);

433 
	}
}

445 
	$sock‘_addr_£ndto
(
fd
, *
buf
, 
size
, *
addr
)

447 
Ën
 = (
sockaddr
);

449  
	`£ndto
(
fd
, 
buf
, 
size
, 0, (
sockaddr
 *)
addr
, (
sockËn_t
)
Ën
);

450 
	}
}

466 
	$sock‘_»cv
(
fd
, *
buf
, 
size
)

468  
	`»cv
(
fd
, 
buf
, 
size
, 0);

469 
	}
}

481 
	$sock‘_time_»cv
(
fd
, *
buf
, 
size
, 
time_ms
)

483 
timev®
 
tv
 = {0};

484 
fd_£t
 
fds
;

485 
ÿn_»cv_by‹s
 = 0;

486 
¹
 = -1;

489 
	`FD_ZERO
(&
fds
);

490 
	`FD_SET
(
fd
, &
fds
);

493 
tv
.
tv_£c
 = 
time_ms
 / 1000;

494 
tv
.
tv_u£c
 = 
time_ms
 % 1000;

495 
	`£Ëù
(
fd
 + 1, &
fds
, 
NULL
, NULL, &
tv
);

498 ià(
	`FD_ISSET
(
fd
, &
fds
))

500 
ÿn_»cv_by‹s
 = 
	`g‘_ÿn_»ad_by‹s
(
fd
);

501 ià(
ÿn_»cv_by‹s
 > 
size
)

502 
¹
 = 
	`»cv
(
fd
, 
buf
, 
size
, 0);

503 
¹
 = 
	`»cv
(
fd
, 
buf
, 
ÿn_»cv_by‹s
, 0);

506  
¹
;

507 
	}
}

524 
	$sock‘_»cväom
(
fd
, *
buf
, 
size
, cÚ¡ *

, 
pÜt
)

526 
sockaddr_š
 
addr
 = {0};

527 
Ën
 = (
sockaddr_š
);

529 
addr
.
sš_çmy
 = 
AF_INET
;

530 
addr
.
sš_addr
.
s_addr
 = 
	`š‘_addr
(

);

531 
addr
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

533  
	`»cväom
(
fd
, 
buf
, 
size
, 0, \

534 (
sockaddr
 *)&
addr
, (
sockËn_t
 *)&
Ën
);

535 
	}
}

547 
	$sock‘_addr_»cväom
(
fd
, *
buf
, 
size
, *
addr
)

549 
Ën
 = (
sockaddr
);

551  
	`»cväom
(
fd
, 
buf
, 
size
, 0, \

552 (
sockaddr
 *)
addr
, (
sockËn_t
 *)&
Ën
);

553 
	}
}

568 
	$g‘_
(

[])

570 
içddrs
 *
içddr
 = 
NULL
;

571 *
tmp_addr
 = 
NULL
;

572 
tmp_
[20] = {0};

573 *
hÇme
 = 
NULL
;

575 ià(

 =ğ
NULL
)  -1;

577 
	`¡rıy
(

, "\0");

578 
	`g‘içddrs
(&
içddr
);

579 
içddr
 !ğ
NULL
)

581 ià(
içddr
->
iç_addr
->
§_çmy
 =ğ
AF_INET
)

583 
tmp_addr
 = &((
sockaddr_š
 *)
içddr
->
iç_addr
)->
sš_addr
;

584 
	`š‘_Áİ
(
AF_INET
, 
tmp_addr
, 
tmp_
, 
INET_ADDRSTRLEN
);

585 
hÇme
 = 
içddr
->
iç_Çme
;

586 ià(
hÇme
[0] !ğ'l'è
	`¡ºıy
(

, 
tmp_
, 20);

589 
içddr
 = içddr->
iç_Ãxt
;

592 
	`ä“içddrs
(
içddr
);

595 
	}
}

605 
	$g‘__by_iâame
(cÚ¡ *
iâame
, *

)

607 
fd
 = -1;

608 
iäeq
 
iä
;

609 
sockaddr_š
 
addr
 = {0};

610 ià(
iâame
 =ğ
NULL
)  -1;

612 
	`¡rıy
(
iä
.
iä_Çme
, 
iâame
);

613 ià((
fd
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0)) < 0)

616 
	`¡rıy
(

, "\0");

617 ià(
	`ioùl
(
fd
, 
SIOCGIFADDR
, &
iä
) == 0)

619 
	`memıy
(&
addr
, &
iä
.
iä_addr
, (ifr.ifr_addr));

620 
	`¡rıy
(

, 
	`š‘_Áß
(
addr
.
sš_addr
));

621 
	`şo£
(
fd
);

625 
	`şo£
(
fd
);

628 
	}
}

638 * 
	$g‘_subÃt_addr
(cÚ¡ *

, cÚ¡ *
mask
)

640 
š_addr
 
l
, 
lmask
, 
subÃt
;

642 ià(

 =ğ
NULL
 || 
mask
 == NULL)  NULL;

644 
	`š‘_©Ú
(

, &
l
);

645 
	`š‘_©Ú
(
mask
, &
lmask
);

647 
subÃt
.
s_addr
 = 
l
.s_add¸& 
lmask
.s_addr;

649  
	`¡rdup
(
	`š‘_Áß
(
subÃt
));

650 
	}
}

659 
	$mask_to_b™s
(cÚ¡ *
mask
)

661 
i
 = 0;

662 
n
 = 0;

663 
š_addr
 
addr
;

664 
b™s
 = () * 8;

666 ià(!
	`m©ch_
(
mask
))  -1;

668 
	`š‘_±Ú
(
AF_INET
, 
mask
, &
addr
);

669 
i
 = 
b™s
 - 1; i >=0; i--)

671 ià(
addr
.
s_addr
 & (0x01 << 
i
))

672 
n
++;

675  
n
;

676 
	}
}

685 
	$g‘_ÿn_»ad_by‹s
(
fd
)

687 
ÿn_»ad_by‹s
 = -1;

689 
	`ioùl
(
fd
, 
FIONREAD
, &
ÿn_»ad_by‹s
);

691  
ÿn_»ad_by‹s
;

692 
	}
}

701 
	$make_sock‘_nÚblock
(
fd
)

703 
æag
 = 0;

704 ià((
æag
 = 
	`fú
(
fd
, 
F_GETFL
, 0)) < 0)

706 
	`³¼Ü
("fcntl F_GETFL");

710 ià(
	`fú
(
fd
, 
F_SETFL
, 
æag
 | 
O_NONBLOCK
) < 0)

712 
	`³¼Ü
("fcntl F_SETFL");

717 
	}
}

726 
	$make_sock‘_block
(
fd
)

728 
æag
 = 0;

729 ià((
æag
 = 
	`fú
(
fd
, 
F_GETFL
, 0)) < 0)

731 
	`³¼Ü
("fcntl F_GETFL");

735 ià(
	`fú
(
fd
, 
F_SETFL
, 
æag
 & ~
O_NONBLOCK
) < 0)

737 
	`³¼Ü
("fcntl F_SETFL");

742 
	}
}

751 
	$make_li¡’_sock‘_»u£abË
(
fd
)

753 
Ú
 = 1;

755  
	`£tsockİt
(
fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, (*)&
Ú
, (on));

756 
	}
}

779 
	$make_sock‘_şo£Ãxec
(
fd
)

781 
æags
 = 0;

783 ià((
æags
 = 
	`fú
(
fd
, 
F_GETFD
, 
NULL
)) < 0)

785 
	`³¼Ü
("fcntl F_GETFD");

789 ià(
	`fú
(
fd
, 
F_SETFD
, 
æags
 | 
FD_CLOEXEC
) == -1)

791 
	`³¼Ü
("fcntl F_SETFD");

796 
	}
}

805 
	$make_sock‘_k“p_®ive
(
fd
)

807 
k“p_®ive
 = 1;

808 
k“p_idË
 = 60;

810 
k“p_š‹rv®
 = 5;

811 
k“p_couÁ
 = 3;

817 ià(
	`£tsockİt
(
fd
, 
SOL_SOCKET
, 
SO_KEEPALIVE
, \

818 &
k“p_®ive
, (keep_alive)) == -1)

820 
	`³¼Ü
("set keep‡live");

829 ià(
	`£tsockİt
(
fd
, 
IPPROTO_TCP
, 
TCP_KEEPIDLE
, \

830 &
k“p_idË
, (keep_idle)) == -1)

832 
	`³¼Ü
("set keep idle");

839 ià(
	`£tsockİt
(
fd
, 
IPPROTO_TCP
, 
TCP_KEEPINTVL
, \

840 &
k“p_š‹rv®
, (keep_interval)) == -1)

842 
	`³¼Ü
("set keep interval");

848 ià(
	`£tsockİt
(
fd
, 
IPPROTO_TCP
, 
TCP_KEEPCNT
, \

849 &
k“p_couÁ
, (keep_count)) == -1)

851 
	`³¼Ü
("set keep idle");

856 
	}
}

866 
	$£t_sock‘_»cv_buf
(
fd
, 
buf_size
)

868 ià(
	`£tsockİt
(
fd
, 
SOL_SOCKET
, 
SO_RCVBUF
, &
buf_size
, (buf_size)) < 0)

870 
	`³¼Ü
("set„ecv buf size");

875 
	}
}

885 
	$£t_sock‘_£nd_buf
(
fd
, 
buf_size
)

887 ià(
	`£tsockİt
(
fd
, 
SOL_SOCKET
, 
SO_SNDBUF
, &
buf_size
, (buf_size)) < 0)

889 
	`³¼Ü
("set send buf size");

894 
	}
}

903 
	$g‘_sock‘_»cv_buf
(
fd
)

905 
buf_size
 = 0;

906 
Ën
 = (
buf_size
);

908 ià(
	`g‘sockİt
(
fd
, 
SOL_SOCKET
, 
SO_RCVBUF
, &
buf_size
, \

909 (
sockËn_t
 *)&
Ën
) < 0)

911 
	`³¼Ü
("get„ecv buf size");

915  
buf_size
;

916 
	}
}

925 
	$g‘_sock‘_£nd_buf
(
fd
)

927 
buf_size
 = 0;

928 
Ën
 = (
buf_size
);

930 ià(
	`g‘sockİt
(
fd
, 
SOL_SOCKET
, 
SO_SNDBUF
, &
buf_size
, \

931 (
sockËn_t
 *)&
Ën
) < 0)

933 
	`³¼Ü
("get send buf size");

937  
buf_size
;

938 
	}
}

949 
	$make_sock‘_şo£_aùiÚ
(
fd
, 
is_Ú
, 
tm_s
)

951 
lšg”
 
so_lšg”
 = {0};

953 
so_lšg”
.
l_Úoff
 = 
is_Ú
;

954 
so_lšg”
.
l_lšg”
 = 
tm_s
;

956 ià(
	`£tsockİt
(
fd
, 
SOL_SOCKET
, 
SO_LINGER
, \

957 &
so_lšg”
, (so_linger)))

959 
	`³¼Ü
("setsockopt so_linger");

964 
	}
}

974 
	$make_sock‘_brßdÿ¡
(
fd
, 
Ú
)

976 ià(
	`£tsockİt
(
fd
, 
SOL_SOCKET
, 
SO_BROADCAST
, \

977 &
Ú
, (on)))

979 
	`³¼Ü
("setsockopt so_broadcast");

985 
	}
}

995 
	$make_sock‘_muÉiÿ¡_loİ
(
fd
, 
Ú
)

997 ià(
	`£tsockİt
(
fd
, 
IPPROTO_IP
, 
IP_MULTICAST_LOOP
, \

998 &
Ú
, (on)))

1000 
	`³¼Ü
("setsockopt so_multicast_loop");

1006 
	}
}

1016 
	$make_sock‘_muÉiÿ¡_‰l
(
fd
, 
‰l
)

1018 ià(
	`£tsockİt
(
fd
, 
IPPROTO_IP
, 
IP_MULTICAST_TTL
, \

1019 &
‰l
, (ttl)))

1021 
	`³¼Ü
("setsockopt so_multicast_ttl");

1027 
	}
}

1037 
	$add_sock‘_to_memb”sh
(
fd
, 
_m»q
 *
mrq
)

1039 ià(
	`£tsockİt
(
fd
, 
IPPROTO_IP
, 
IP_ADD_MEMBERSHIP
, \

1040 
mrq
, (
_m»q
)))

1042 
	`³¼Ü
("setsockopt so_multicast_ttl");

1048 
	}
}

1058 
	$drİ_sock‘_äom_memb”sh
(
fd
, 
_m»q
 *
mrq
)

1060 ià(
	`£tsockİt
(
fd
, 
IPPROTO_IP
, 
IP_DROP_MEMBERSHIP
, \

1061 
mrq
, (
_m»q
)))

1063 
	`³¼Ü
("setsockopt so_multicast_ttl");

1069 
	}
}

1078 
	$g‘_sock‘_£nd_timeout
(
fd
)

1080 
timev®
 
tv
 = {0};

1082 
Ën
 = (
tv
);

1084 ià(
	`g‘sockİt
(
fd
, 
SOL_SOCKET
, 
SO_SNDTIMEO
, \

1085 &
tv
, (
sockËn_t
 *)&
Ën
))

1087 
	`³¼Ü
("getsockopt so_sndtimeo");

1092  (
tv
.
tv_£c
 * 1000 +v.
tv_u£c
);

1094 
	}
}

1103 
	$g‘_sock‘_»cv_timeout
(
fd
)

1105 
timev®
 
tv
 = {0};

1106 
Ën
 = (
tv
);

1108 ià(
	`g‘sockİt
(
fd
, 
SOL_SOCKET
, 
SO_RCVTIMEO
, \

1109 &
tv
, (
sockËn_t
 *)&
Ën
))

1111 
	`³¼Ü
("getsockopt so_rcvtimeo");

1115  (
tv
.
tv_£c
 * 1000 +v.
tv_u£c
);

1117 
	}
}

1127 
	$make_sock‘_£nd_timeout
(
fd
, 
tm_ms
)

1129 
timev®
 
tv
 = {0};

1130 
Ën
 = (
tv
);

1132 
tv
.
tv_£c
 = 
tm_ms
 / 1000;

1133 
tv
.
tv_u£c
 = 
tm_ms
 % 1000;

1134 ià(
	`£tsockİt
(
fd
, 
SOL_SOCKET
, 
SO_SNDTIMEO
, \

1135 &
tv
, 
Ën
))

1137 
	`³¼Ü
("setsockopt so_sndtimeo");

1143 
	}
}

1153 
	$make_sock‘_»cv_timeout
(
fd
, 
tm_ms
)

1155 
timev®
 
tv
 = {0};

1156 
Ën
 = (
tv
);

1158 
tv
.
tv_£c
 = 
tm_ms
 / 1000;

1159 
tv
.
tv_u£c
 = 
tm_ms
 % 1000;

1160 ià(
	`£tsockİt
(
fd
, 
SOL_SOCKET
, 
SO_RCVTIMEO
, \

1161 &
tv
, 
Ën
))

1163 
	`³¼Ü
("setsockopt so_rcvtimeo");

1169 
	}
}

1178 
	$g‘_sock‘_ty³
(
fd
)

1180 
ty³
 = -1;

1181 
Ën
 = (
ty³
);

1183 ià(
	`g‘sockİt
(
fd
, 
SOL_SOCKET
, 
SO_TYPE
, \

1184 &
ty³
, (
sockËn_t
 *)&
Ën
))

1186 
	`³¼Ü
("getsockopt so_sndtimeo");

1190  
ty³
;

1192 
	}
}

1201 * 
	$g‘_sock‘_ty³_¡r
(
fd
)

1203 
ty³
 = -1;

1204 
Ën
 = (
ty³
);

1205 
i
 = 0;

1207 ià(
	`g‘sockİt
(
fd
, 
SOL_SOCKET
, 
SO_TYPE
, \

1208 &
ty³
, (
sockËn_t
 *)&
Ën
))

1210 
	`³¼Ü
("getsockopt so_sndtimeo");

1211  
NULL
;

1214 
sock‘_ty³
[
i
].
ty³_Çme
 !ğ
NULL
)

1216 ià(
sock‘_ty³
[
i
].
ty³_maüo
 =ğ
ty³
)

1218 
i
++;

1221  
sock‘_ty³
[
i
].
ty³_Çme
;

1222 
	}
}

1233 
	$make_sock‘_´omisc
(cÚ¡ *
iâame
, 
fd
, 
Ú
)

1235 
iäeq
 
»q
;

1237 
	`¡rıy
(
»q
.
iä_Çme
, 
iâame
);

1238 ià(
	`ioùl
(
fd
, 
SIOCGIFFLAGS
, &
»q
) < 0)

1240 
	`³¼Ü
("ioctl get interface flags");

1244 ià(
Ú
è
»q
.
iä_æags
 |ğ
IFF_PROMISC
;

1245 
»q
.
iä_æags
 &ğ~
IFF_PROMISC
;

1247 ià(
	`ioùl
(
fd
, 
SIOCSIFFLAGS
, &
»q
) < 0)

1249 
	`³¼Ü
("ioctl set interface flags");

1253 
	}
}

1263 
	$g‘_š‹rçû_šdex
(
fd
, 
iäeq
 *
»q
)

1265 ià(
	`ioùl
(
fd
, 
SIOCGIFINDEX
, &
»q
) < 0)

1267 
	`³¼Ü
("get interface index");

1272 
	}
}

1281 
	$g‘_iâame
(*
iâame
)

1283 
iäeq
 
iä
;

1284 
ifcÚf
 
ifc
;

1285 
buf
[2048];

1287 ià(
iâame
 =ğ
NULL
)  -1;

1288 
sock
 = 
	`sock‘
(
AF_INET
, 
SOCK_DGRAM
, 
IPPROTO_IP
);

1289 ià(
sock
 == -1) {

1290 
	`´štf
("socketƒrror\n");

1294 
ifc
.
ifc_Ën
 = (
buf
);

1295 
ifc
.
ifc_buf
 = 
buf
;

1296 ià(
	`ioùl
(
sock
, 
SIOCGIFCONF
, &
ifc
) == -1)

1298 
	`´štf
("ioctlƒrror\n");

1302 
couÁ
 = 0;

1303 
iäeq
* 
™
 = 
ifc
.
ifc_»q
;

1304 cÚ¡ 
iäeq
* cÚ¡ 
’d
 = 
™
 + (
ifc
.
ifc_Ën
 / (ifreq));

1306 
	`¡rıy
(
iâame
, "\0");

1307 ; 
™
 !ğ
’d
; ++it)

1309 
	`¡rıy
(
iä
.
iä_Çme
, 
™
->ifr_name);

1310 ià(
	`ioùl
(
sock
, 
SIOCGIFFLAGS
, &
iä
) == 0)

1312 ià(! (
iä
.
iä_æags
 & 
IFF_LOOPBACK
))

1314 ià(
	`ioùl
(
sock
, 
SIOCGIFHWADDR
, &
iä
) == 0)

1316 
couÁ
 ++ ;

1317 
	`¡rÿt
(
iâame
, 
iä
.
iä_Çme
);

1318 
	`¡rÿt
(
iâame
, " ");

1324 
	`´štf
("get mac infoƒrror\n");

1330 
	}
}

1337 
	$is_big_’dŸn
()

1340 
s
;

1341 
c
[()];

1342 } 
un
;

1344 
un
.
s
 = 0x0102;

1347 ià(
un
.
c
[0] == 0x01 && un.c[1] == 0x02)

1349 
	`´štf
("bigƒndian\n");

1352 ià(
un
.
c
[0] == 0x02 && un.c[1] == 0x01)

1354 
	`´štf
("littleƒndian\n");

1359 
	`´štf
("unknown\n");

1363 
	`´štf
("sizeof(short) = %d\n", ());

1366 
	}
}

1375 
	$m©ch_
(cÚ¡ *

)

1377 
¹
 = 0;

1378 
pošt_couÁ
 = 0;

1379 cÚ¡ *
p
 = 

;

1380 
š_addr
 
addr
 ;

1382 ià(
p
 =ğ
NULL
è
»t
;

1383 *
p
 != '\0')

1385 ià(*
p
 =ğ'.'è
pošt_couÁ
++;

1386 
p
++;

1388 ià(
pošt_couÁ
 !ğ3 || (
p
 - 

è< 7è
»t
;

1390 ià(!
	`š‘_©Ú
(

, &
addr
)è
»t
;

1391 
¹
 = 
	`š‘_©Ú
(
	`š‘_Áß
(
addr
), 
NULL
);

1393 
»t
:

1394  
¹
;

1395 
	}
}

	@socket_base.h

1 #iâdeà
__SOCKET_BASE_H__


2 
	#__SOCKET_BASE_H__


	)

4 
	~<¡dio.h
>

5 
	~<¡dlib.h
>

6 
	~<¡ršg.h
>

7 
	~<uni¡d.h
>

8 
	~<fú.h
>

9 
	~<sys/”ºo.h
>

10 
	~<sys/sysšfo.h
>

11 
	~<sys/ty³s.h
>

12 
	~<sys/sock‘.h
>

13 
	~<sys/ioùl.h
>

14 
	~<Ãtš‘/š.h
>

15 
	~<¬·/š‘.h
>

16 
	~<Ãtdb.h
>

17 
	~<içddrs.h
>

18 
	~<sys/un.h
>

19 
	~<Ãt/if.h
>

20 
	~<lšux/if_‘h”.h
>

21 
	~<Ãtš‘/tı.h
>

27 #iâdeà
MACRO_STR


28 
	#MACRO_STR
(
x
è{x, #x}

	)

41 
	ssock‘_ty³
 {

45 
	mty³_maüo
;

50 *
	mty³_Çme
;

51 } 
	gsock‘_ty³
[] = {

52 
MACRO_STR
(
SOCK_STREAM
) ,

53 
MACRO_STR
(
SOCK_DGRAM
) ,

54 
MACRO_STR
(
SOCK_RAW
) ,

55 
MACRO_STR
(
SOCK_RDM
) ,

56 
MACRO_STR
(
SOCK_SEQPACKET
) ,

57 
MACRO_STR
(
SOCK_PACKET
) ,

58 {-1, 
NULL
}

73 
sock‘_ü—‹
(
domaš
, 
ty³
);

82 
š‘_addr_š™
(
sockaddr_š
 *
addr
, cÚ¡ *

, 
u_shÜt
 
pÜt
);

90 
loÿl_addr_š™
(
sockaddr_un
 *
addr
, cÚ¡ *
·th
);

100 
sock‘_bšd
(
fd
, 
sockaddr
 *
addr
);

110 
sock‘_li¡’
(
fd
, 
backlog
);

123 
¡¬tup_š‘_£rv”
(
ty³
, cÚ¡ *

, \

124 
u_shÜt
 
pÜt
);

137 
¡¬tup_š‘_ş›Á
(
ty³
, 
sockaddr_š
 *
addr
, \

138 cÚ¡ *

, 
u_shÜt
 
pÜt
);

151 
¡¬tup_loÿl_£rv”
(
ty³
, cÚ¡ *
·th
);

162 
¡¬tup_loÿl_ş›Á
(
ty³
, 
sockaddr_un
 *
addr
, cÚ¡ *
·th
);

172 
sock‘_acû±
(
fd
);

182 
sock‘_cÚÃù
(
fd
, *
şi_addr
);

193 
sock‘_time_cÚÃù
(
fd
, *
şi_addr
, 
tm_ms
);

202 
sock‘_şo£
(
fd
);

217 
sock‘_£nd
(
fd
, *
buf
, 
size
);

229 
sock‘_time_£nd
(
fd
, *
buf
, 
size
, 
time_ms
);

246 
sock‘_£ndto
(
fd
, *
buf
, 
size
, cÚ¡ *

, 
pÜt
);

258 
sock‘_addr_£ndto
(
fd
, *
buf
, 
size
, *
addr
);

274 
sock‘_»cv
(
fd
, *
buf
, 
size
);

286 
sock‘_time_»cv
(
fd
, *
buf
, 
size
, 
time_ms
);

304 
sock‘_»cväom
(
fd
, *
buf
, 
size
, cÚ¡ *

, 
pÜt
);

316 
sock‘_addr_»cväom
(
fd
, *
buf
, 
size
, *
addr
);

330 
g‘_
(

[]);

340 
g‘__by_iâame
(cÚ¡ *
iâame
, *

);

350 * 
g‘_subÃt_addr
(cÚ¡ *

, cÚ¡ *
mask
);

359 
mask_to_b™s
(cÚ¡ *
mask
);

368 
g‘_iâame
(*
iâame
);

377 
g‘_ÿn_»ad_by‹s
(
fd
);

386 
make_sock‘_nÚblock
(
fd
);

395 
make_sock‘_block
(
fd
);

404 
make_li¡’_sock‘_»u£abË
(
fd
);

413 
make_sock‘_k“p_®ive
(
fd
);

422 
make_sock‘_şo£Ãxec
(
fd
);

432 
£t_sock‘_»cv_buf
(
fd
, 
buf_size
);

442 
£t_sock‘_£nd_buf
(
fd
, 
buf_size
);

451 
g‘_sock‘_»cv_buf
(
fd
);

460 
g‘_sock‘_£nd_buf
(
fd
);

471 
make_sock‘_şo£_aùiÚ
(
fd
, 
is_Ú
, 
tm_s
);

481 
make_sock‘_brßdÿ¡
(
fd
, 
Ú
);

491 
make_sock‘_muÉiÿ¡_loİ
(
fd
, 
Ú
);

501 
make_sock‘_muÉiÿ¡_‰l
(
fd
, 
‰l
);

511 
add_sock‘_to_memb”sh
(
fd
, 
_m»q
 *
mrq
);

521 
drİ_sock‘_äom_memb”sh
(
fd
, 
_m»q
 *
mrq
);

530 
g‘_sock‘_£nd_timeout
(
fd
);

539 
g‘_sock‘_»cv_timeout
(
fd
);

549 
make_sock‘_£nd_timeout
(
fd
, 
tm_ms
);

559 
make_sock‘_»cv_timeout
(
fd
, 
tm_ms
);

568 
g‘_sock‘_ty³
(
fd
);

577 * 
g‘_sock‘_ty³_¡r
(
fd
);

588 
make_sock‘_´omisc
(cÚ¡ *
iâame
, 
fd
, 
Ú
);

598 
g‘_š‹rçû_šdex
(
fd
, 
iäeq
 *
»q
);

605 
is_big_’dŸn
();

614 
m©ch_
(cÚ¡ *

);

	@socket_msg.c

1 
	~"sock‘_msg.h
"

3 
msg_r¡_t
 
	$shm_š™
(
msg_ùl
 *
p_ùl
)

5 
key_t
 
key
 = -1;

6 
shm_exi¡
 = 0;

7 
shmid
 = -1;

8 *
shmaddr
 = 
NULL
;

9 
±h»ad_rwlock©Œ_t
 
©Œ
;

11 ià((
key
 = 
	`áok
("/tmp", 0x0369)è=ğ-1è 
MSG_RST_FAILURE
;

12 ià((
shmid
 = 
	`shmg‘
(
key
, (
shm_ùl
), 
IPC_CREAT
 | 
IPC_EXCL
 | 0x600)) == -1)

14 ià(
”ºo
 =ğ
EEXIST
)

16 
shm_exi¡
 = 1;

17 
shmid
 = 
	`shmg‘
(
key
, (
shm_ùl
), 0x600);

18 ià(
shmid
 =ğ-1è 
MSG_RST_FAILURE
;

20  
MSG_RST_FAILURE
;

23 
shmaddr
 = 
	`shm©
(
shmid
, 
NULL
, 0);

24 ià((*)-1 =ğ
shmaddr
)

26 ià(!
shm_exi¡
è
	`shmùl
(
shmid
, 
IPC_RMID
, 0);

27  
MSG_RST_FAILURE
;

30 
p_msg_ùl
->
p_shm_ùl
 = 
shmaddr
;

31 ià(!
shm_exi¡
)

33 
	`mem£t
(
p_msg_ùl
->
p_shm_ùl
, 0, (
shm_ùl
));

34 
	`±h»ad_rwlock©Œ_š™
(&
©Œ
);

35 
	`±h»ad_rwlock©Œ_£sh¬ed
(&
©Œ
, 
PTHREAD_PROCESS_SHARED
);

36 
	`±h»ad_rwlock_š™
(&(
p_msg_ùl
->
p_shm_ùl
->
rwlock
), &
©Œ
);

37 
	`±h»ad_rwlock©Œ_de¡roy
(&
©Œ
);

40  
MSG_RST_SUCCESS
;

41 
	}
}

43 
	$İ’_loÿl_sock‘
(cÚ¡ *
·th
)

45 
fd
 = -1;

46 
»t
 = -1;

47 
sockaddr_un
 
addr
 = {0};

49 
fd
 = 
	`sock‘_ü—‹
(
PF_UNIX
, 
SOCK_DGRAM
);

50 ià(
fd
 =ğ-1è 
»t
;

52 
	`mem£t
(&
addr
, 0, (
sockaddr_un
));

53 
addr
.
sun_çmy
 = 
AF_UNIX
;

54 
	`¡ºıy
(
addr
.
sun_·th
, 
·th
, (addr.sun_path));

55 
addr
.
sun_·th
[(addr.sun_path) - 1] = '\0';

56 
	`uÆšk
(
addr
.
sun_·th
) ;

58 
»t
 = 
	`bšd
(
fd
, (
sockaddr
 *)&
addr
, (addr));

59 ià(
»t
 == -1)

61 
	`şo£
(
fd
);

62  
»t
;

65  
fd
;

66 
	}
}

68 
	$c_addr_š™
(
sockaddr_un
 *
c_addr
)

70 
	`mem£t
(
c_addr
, 0, (
sockaddr_un
));

71 
c_addr
->
sun_çmy
 = 
AF_UNIX
;

72 
	`¢´štf
(
c_addr
->
sun_·th
, (c_addr->sun_·th), "%s%d", 
MSG_SOCKET_DIR
, 
	`g‘pid
());

73 
c_addr
->
sun_·th
[(ipc_addr->sun_path) - 1] = '\0';

76 
	}
}

78 *
	$c_func
(*
¬g
)

80 
msg
 *msg = 
NULL
;

81 
Ën
 = 0;

83 
p_msg_ùl
->
c_¡İ
)

85 ià(
NULL
 =ğ(
msg
 = 
	`m®loc
(
MSG_MAX_LEN
)))

87 
	`şo£
(
p_msg_ùl
->
c_fd
);

91 
Ën
 = 
	`»ad
(
p_msg_ùl
->
c_fd
, 
msg
, 
MSG_MAX_LEN
);

92 ià(
Ën
 < (
msg
))

94 
	`ä“
(
msg
);

98 
msg
->
de¡ruùÜ
 = 
NULL
;

99 
msg
->
ä“_±r
 = 
NULL
;

100 
msg
->
hŞd_út
 = 1;

103  
NULL
;

104 
	}
}

106 
msg_r¡_t
 
	$c_š™
(
msg_ùl
 *
p_ùl
)

111 
sockaddr_un
 
c_addr
 = {0};

113 
	`c_addr_š™
(&
c_addr
);

114 
p_msg_ùl
->
c_fd
 = 
	`İ’_loÿl_sock‘
(
c_addr
.
sun_·th
);

115 ià(
p_msg_ùl
->
c_fd
 =ğ-1è 
MSG_RST_FAILURE
;

117 ià(
	`±h»ad_ü—‹
(&
p_msg_ùl
->
c_th»ad
, 
NULL
, 
c_func
, NULL) != 0)

119 
	`şo£
(
p_msg_ùl
->
c_fd
);

120  
MSG_RST_FAILURE
;

123  
MSG_RST_SUCCESS
;

124 
	}
}

126 
msg_r¡_t
 
	$msg_š™
()

128 ià(
p_msg_ùl
 !ğ
NULL
è 
MSG_RST_SUCCESS
;

131 
p_msg_ùl
 = (
msg_ùl
 *)
	`m®loc
((msg_ctl));

132 ià(
p_msg_ùl
 =ğ
NULL
) ;

133 
	`mem£t
(
p_msg_ùl
, 0, (
msg_ùl
));

135 
p_msg_ùl
->
p_loc_ùl
 = (
loc_ùl
 *)
	`m®loc
((loc_ctl));

136 ià(
p_msg_ùl
->
p_loc_ùl
 =ğ
NULL
) ;

137 
	`mem£t
(
p_msg_ùl
->
p_loc_ùl
, 0, (
loc_ùl
));

139 ià(
	`shm_š™
(
p_msg_ùl
è!ğ
MSG_RST_SUCCESS
è 
MSG_RST_FAILURE
;

140 ià(
	`c_š™
(
p_msg_ùl
è!ğ
MSG_RST_SUCCESS
è 
MSG_RST_FAILURE
;

143  
MSG_RST_SUCCESS
;

146 ià(
p_msg_ùl
->
p_loc_ùl
 !ğ
NULL
è
	`ä“
(p_msg_ctl->p_loc_ctl);

147 ià(
p_msg_ùl
 !ğ
NULL
è
	`ä“
(p_msg_ctl);

149  
MSG_RST_FAILURE
;

150 
	}
}

152 
msg_r¡_t
 
	$msg_deš™
()

154 ià(
p_msg_ùl
 =ğ
NULL
è 
MSG_RST_SUCCESS
;

156 ià(
p_msg_ùl
->
p_loc_ùl
)

158 
	`±h»ad_rwlock_de¡roy
(&
p_msg_ùl
->
p_loc_ùl
->
rwlock
);

159 
	`ä“
(
p_msg_ùl
->
p_loc_ùl
);

162 
	`ä“
(
p_msg_ùl
);

163 
p_msg_ùl
 = 
NULL
;

165  
MSG_RST_SUCCESS
;

166 
	}
}

168 
msg_r¡_t
 
	$msg_moduË_»g
(
msg_mod_cfg
 *
cfg
)

170 
i
 = 0;

171 
loc_ùl
 *
p_loc_ùl
 = 
p_msg_ùl
->p_loc_ctl;

172 
loÿl_msg_’Œy
 *
p_’Œy
 = 
NULL
;

174 ià(
cfg
 =ğ
NULL
 || cfg->
hªdËr
 =ğNULL || 
p_msg_ùl
 == NULL)

175  
MSG_RST_FAILURE
;

177 
	`±h»ad_rwlock_w¾ock
(&
p_loc_ùl
->
rwlock
);

178 
i
 = 0; i < 32; i++)

180 ià(
p_loc_ùl
->
»g_tbl
[
i
].
mod_id
 =ğ
cfg
->mod_id)

182 
p_’Œy
 = &
p_loc_ùl
->
»g_tbl
[
i
];

185 ià(!
p_’Œy
 && 
p_loc_ùl
->
»g_tbl
[
i
].
mod_id
 =ğ
MOD_ID_UNKNOW
)

186 
p_’Œy
 = &(
p_loc_ùl
->
»g_tbl
[
i
]);

190 ià(
p_’Œy
 =ğ
NULL
)

192 
	`±h»ad_rwlock_uÆock
(&
p_loc_ùl
->
rwlock
);

193  
MSG_RST_FAILURE
;

196 ià(
p_’Œy
->
mod_id
 =ğ
cfg
->mod_id)

198 
	`±h»ad_rwlock_uÆock
(&
p_loc_ùl
->
rwlock
);

199  
MSG_RST_SUCCESS
;

205  
MSG_RST_SUCCESS
;

206 
	}
}

	@socket_msg.h

1 #iâdeà
__SOCKET_MSG_H__


2 
	#__SOCKET_MSG_H__


	)

4 #iâdeà
__SOCKET_BASE_H__


5 
	~<sock‘_ba£.h
>

8 
	~<sys/shm.h
>

9 
	~<£m­hÜe.h
>

10 
	~<±h»ad.h
>

15 
	#MOD_MAX
 32

	)

16 
	#MSG_MAX_LEN
 (1024 * 32)

	)

17 
	#MSG_SOCKET_DIR
 "/v¬/msg/"

	)

22 
	tmod_id_t
;

23 
	tmsg_æag_t
;

29 
	emsg_r¡
 {

30 
	mMSG_RST_SUCCESS
 = 0,

31 
	mMSG_RST_FAILURE
,

32 
	mMSG_RST_INVALID_CFG
,

33 
	mMSG_RST_INVALID_MOD_ID
,

34 
	mMSG_RST_SOCKET_ERROR
,

35 
	mMSG_RST_THREAD_ERROR
,

36 
	mMSG_RST_QUEUE_FULL


37 } 
	tmsg_r¡_t
;

40 
	mMOD_ID_UNKNOW
 = 0,

41 
	mMOD_ID_TMR
 = 1

47 
	smsg
 {

48 
	m’dŸn
;

49 
mod_id_t
 
	m¤c_id
;

50 
mod_id_t
 
	md¡_id
;

51 
mod_id_t
 
	mmod
;

52 
	mmsg_id
;

53 
	mËn
;

54 
	mhŞd_út
;

56 (*
	mde¡ruùÜ
)(*);

57 *
	mä“_±r
;

58 
msg
 *
	mÃxt
;

63 
	mbody
[0];

64 } 
	tmsg_t
;

66 
	#MSG
(
p
è((
msg
 *)Õ))

	)

67 
	#MSG_MOD
(
p
èĞ
	`MSG
Õ)->
mod
 )

	)

68 
	#MSG_MSGID
(
p
èĞ
	`MSG
Õ)->
msg_id
 )

	)

69 
	#MSG_LEN
(
p
èĞ
	`MSG
Õ)->
Ën
 )

	)

70 
	#MSG_DATA
(
p
èĞ
	`MSG
Õ)->
body
 )

	)

71 
	#MSG_SRC
(
p
èĞ
	`MSG
Õ)->
¤c_id
 )

	)

73 Ğ*
	tmsg_hªdËr_t
 )(
	tmsg
 *msg);

74 
	$msg_æag_t
 ( *
	tmsg_id’t
 )(
	tmsg
 *msg);

82 
	smsg_mod_cfg
 {

83 *
Çme
;

84 
mod_id_t
 
mod_id
;

85 
±h»ad_t
 
th»ad_id
;

86 
msg_hªdËr_t
 
hªdËr
;

87 } 
	tmsg_mod_cfg_t
;

90 
	sloÿl_msg_’Œy
 {

94 
mod_id_t
 
mod_id
;

99 
pos
;

100 
£m_t
 
£m
;

101 
±h»ad_mu‹x_t
 
mtx
;

102 
msg
 *
hªdlšg_msg
;

107 
msg_id’t
 
id’t
;

108 
msg_hªdËr_t
 
hªdËr
;

109 
±h»ad_t
 
´oc_th»ad
;

110 
´oc_¡İ
;

115 
msg_hdËd_tÙ®
;

116 
mod_»g_sys_u±ime
;

117 } 
	tloÿl_’Œy_t
;

119 
	sshm_’Œy
 {

120 
mod_id_t
 
mod_id
;

121 
æag
;

122 
sockaddr_š
 
š_addr
;

123 
sockaddr_un
 
un_addr
;

124 } 
	tshm_’Œy_t
;

126 
	smsg_ùl
 {

130 
	sloc_ùl
 {

131 
±h»ad_rwlock_t
 
rwlock
;

132 
loÿl_msg_’Œy
 
»g_tbl
[ 
MOD_MAX
 ];

133 } *
p_loc_ùl
;

138 
	sshm_ùl
 {

139 
±h»ad_rwlock_t
 
rwlock
;

140 
shm_’Œy
 
»g_tbl
[ 
MOD_MAX
 ];

141 } *
p_shm_ùl
;

146 
c_fd
;

147 
±h»ad_t
 
c_th»ad
;

148 
c_¡İ
;

149 } 
	tmsg_ùl_t
;

151 
msg_ùl
 *
p_msg_ùl
;

	@
1
.
0
5
64
cli/cli.c
socket_base.c
socket_base.h
socket_msg.c
socket_msg.h
