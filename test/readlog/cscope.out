cscope 15 $HOME/working/program/c/readlog -q 0000000086 0000005812
	@readlog.c

1 
	~<°dio.h
>

2 
	~<°dlib.h
>

3 
	~<°rög.h
>

4 
	~<time.h
>

7 
	#TIME_INTERVAL
 5

	)

9 
	#THRESHOLD
 1

	)

11 
	#SIZE_OF_STRING_TIME
 20

	)

13 
	#SIZE_OF_BUFFER
 512

	)

15 
èg_time_d©a
 
	ttime_d©a
, *
	tp_time_d©a
;

24 
	sèg_time_d©a
 {

25 
	miTimes
;

26 
	mszTime
[
SIZE_OF_STRING_TIME
];

27 
p_time_d©a
 
	mpNext
;

31 
gë_time_‰om_löe
(*
pchInfo
, 
szTime
[], *
iSec
);

34 
¥öt_li°
(
p_time_d©a
 
hód
);

37 
de°roy_li°
(
p_time_d©a
 
hód
);

40 
≠≥nd_d©a_to_li°
(
time_d©a
 **
hód
, c⁄° 
iTimes
, c⁄° 
szTime
[]);

43 
p_time_d©a
 
gë_middÀ_poöãr
’_time_d©®
pHód
);

46 
mîge
(
time_d©a
 **
pLe·
, 
p_time_d©a
 
pRight
);

49 
mîge_s‹t
(
time_d©a
 **
pHód
);

52 
cmp
(c⁄° **
p1
, c⁄° **
p2
);

54 
	$maö
(
¨gc
, *
agrv
[])

56 i‡(
¨gc
 < 2) {

57 
	`¥ötf
("Error of inputÖarameters.\n");

62 
buf
[
SIZE_OF_BUFFER
] = {0};

63 
szCurTime
[
SIZE_OF_STRING_TIME
] = {0}, 
szPªTime
[SIZE_OF_STRING_TIME] = {0}, 
szSèπTime
[SIZE_OF_STRING_TIME] = {0};

64 
¥eSec
 = 0, 
curSec
 = 0, 
diffSec
 = 0;

65 
iC⁄Times
 = 0, 
iSkùLöes
 = 2;

66 
p_time_d©a
 
d©a
 = 
NULL
;

67 
FILE
 *
Â
 = 
NULL
;

68 
cou¡
 = 0, 
i
 = 0;

71 
Â
 = 
	`f›í
(
agrv
[1], "r");

72 i‡(
NULL
 =
Â
) {

73 
	`¥ötf
("Open file failed.\n");

78 !
	`„of
(
Â
Ë&& 
iSkùLöes
-- > 0)

79 
	`fgës
(
buf
, 
SIZE_OF_BUFFER
, 
Â
);

82 !
	`„of
(
Â
)) {

83 i‡(
	`fgës
(
buf
, 
SIZE_OF_BUFFER
, 
Â
Ë=
NULL
) ;

86 
	`°r˝y
(
szPªTime
, 
szCurTime
);

87 i‡(
	`gë_time_‰om_löe
(
buf
, 
szCurTime
, &
curSec
) == -1)

91 
diffSec
 = 
curSec
 - 
¥eSec
;

92 i‡(
diffSec
 < 0) {

93 
diffSec
 = 
curSec
 + curSe¯* 24 * 60 * 60 - 
¥eSec
;

97 i‡(
diffSec
 < 
TIME_INTERVAL
 + 
THRESHOLD
) {

98 
iC⁄Times
++;

99 i‡(
iC⁄Times
 == 1) {

100 
	`°r˝y
(
szSèπTime
, 
szPªTime
);

103 i‡(
iC⁄Times
 > 1) {

105 
	`≠≥nd_d©a_to_li°
(&
d©a
, 
iC⁄Times
, 
szSèπTime
);

106 
cou¡
++;

110 
iC⁄Times
 = 0;

114 
¥eSec
 = 
curSec
;

119 
	`f˛o£
(
Â
);

120 
Â
 = 
NULL
;

125 
timevÆ
 
°¨t
 = {0};

126 
timevÆ
 
íd
 = {0};

127 
timî
 = 0;

129 
	`gëtimeofday
(&
°¨t
, 
NULL
);

131 
p_time_d©a
 
pTmp
 = 
d©a
;

132 
time_d©a
 **
pAº
 = (time_d©a**)
	`mÆloc
((
p_time_d©a
Ë* 
cou¡
);

133 i‡(
NULL
 =*
pAº
)  -1;

134 
i
 = 0; i < 
cou¡
; i++) {

135 
pAº
[
i
] = 
pTmp
;

136 
pTmp
 =ÖTmp->
pNext
;

140 
	`qs‹t
(
pAº
, 
cou¡
, ’Aº[0]), 
cmp
);

142 
¥eTimes
 = 0, 
curTimes
 = 0;

143 
i
 = 0; i < 
cou¡
; i++) {

144 
curTimes
 = 
pAº
[
i
]->
iTimes
;

145 i‡(
curTimes
 !
¥eTimes
) {

146 
	`¥ötf
("Aµó∏%dÅimes:\n", 
curTimes
);

147 
¥eTimes
 = 
curTimes
;

149 
	`¥ötf
(" %s\n", 
pAº
[
i
]->
szTime
);

152 
	`gëtimeofday
(&
íd
, 
NULL
);

153 
timî
 = 1000000 * (
íd
.
tv_£c
 - 
°¨t
.tv_£cË+Énd.
tv_u£c
 - start.tv_usec;

154 
	`¥ötf
("timî i†%ld us.\n", 
timî
);

159 
	`de°roy_li°
(
d©a
);

162 
	`‰ì
(
pAº
);

165 
	}
}

176 
	$gë_time_‰om_löe
(*
pchInfo
, 
szTime
[], *
iSec
)

178 i‡(
NULL
 =
pchInfo
)  -1;

180 
tm
 
tmTemp
 = {0};

181 c⁄° *
öF‹m©
 = " ENodeBApp Info %F %T";

182 c⁄° *
outF‹m©
 = "%F %T";

183 
	`°Ωtime
(
pchInfo
, 
öF‹m©
, &
tmTemp
);

184 
	`°r·ime
(
szTime
, 
SIZE_OF_STRING_TIME
, 
outF‹m©
, &
tmTemp
);

185 *
iSec
 = 
tmTemp
.
tm_hour
 * 60 * 60 +ÅmTemp.
tm_mö
 * 60 +ÅmTemp.
tm_£c
;

188 
	}
}

200 
	$≠≥nd_d©a_to_li°
(
time_d©a
 **
pHód
, c⁄° 
iTimes
, c⁄° 
szTime
[])

202 
p_time_d©a
 
pTmp
 = *
pHód
, 
pIn£π
;

203 
pIn£π
 = (
p_time_d©a
)
	`mÆloc
((
time_d©a
));

204 i‡(
NULL
 =
pIn£π
)  -1;

207 
pIn£π
->
iTimes
 = iTimes;

208 
	`°r˝y
(
pIn£π
->
szTime
, szTime);

209 
pIn£π
->
pNext
 = 
NULL
;

211 i‡(
NULL
 =
pTmp
) {

212 *
pHód
 = 
pIn£π
;

214 
NULL
 !
pTmp
->
pNext
) {

215 
pTmp
 =ÖTmp->
pNext
;

218 
pTmp
->
pNext
 = 
pIn£π
;

222 
	}
}

233 
	$¥öt_li°
(
p_time_d©a
 
pHód
)

235 
p_time_d©a
 
p
 = 
pHód
;

236 
¥eTimes
 = 0, 
curTimes
 = 0;

238 
NULL
 !
p
) {

239 
curTimes
 = 
p
->
iTimes
;

240 i‡(
curTimes
 !
¥eTimes
)

241 
	`¥ötf
("Aµó∏%dÅimes:\n", 
curTimes
);

242 
¥eTimes
 = 
curTimes
;

244 
	`¥ötf
(" %s\n", 
p
->
szTime
);

245 
p
 =Ö->
pNext
;

247 
	}
}

257 
	$de°roy_li°
(
p_time_d©a
 
hód
)

259 
p_time_d©a
 
p
;

261 
NULL
 !
hód
) {

262 
p
 = 
hód
->
pNext
;

263 
	`‰ì
(
hód
);

264 
hód
 = 
p
;

268 
	}
}

278 
p_time_d©a
 
	$gë_middÀ_poöãr
(
p_time_d©a
 
pHód
)

281 
p_time_d©a
 
pMid
 = 
pHód
, 
pTmp
 =ÖHód, 
pMidLe·
 = 
NULL
;

283 
NULL
 !
pTmp
 && NULL !pTmp->
pNext
) {

284 
pTmp
 =ÖTmp->
pNext
->pNext;

285 
pMidLe·
 = 
pMid
;

286 
pMid
 =ÖMid->
pNext
;

288 
pMidLe·
->
pNext
 = 
NULL
;

290  
pMid
;

291 
	}
}

303 
	$mîge
(
time_d©a
 **
pLe·
, 
p_time_d©a
 
pRight
)

306 
p_time_d©a
 
∂
 = *
pLe·
, 
¥
 = 
pRight
;

307 
p_time_d©a
 
pHód
 = 
NULL
;

308 
p_time_d©a
 
pResu…
 = 
NULL
;

311 i‡(
∂
->
iTimes
 >
¥
->iTimes) {

312 
pHód
 = 
pResu…
 = 
∂
;

313 
∂
 =Öl->
pNext
;

315 
pHód
 = 
pResu…
 = 
¥
;

316 
¥
 =Ör->
pNext
;

320 
∂
 !
NULL
 && 
¥
 != NULL) {

321 i‡(
∂
->
iTimes
 >
¥
->iTimes) {

322 
pResu…
->
pNext
 = 
∂
;

323 
∂
 =Öl->
pNext
;

325 
pResu…
->
pNext
 = 
¥
;

326 
¥
 =Ör->
pNext
;

329 
pResu…
 =ÖResu…->
pNext
;

333 i‡(
∂
 =
NULL
Ë
pResu…
->
pNext
 = 
¥
;

334 i‡(
¥
 =
NULL
Ë
pResu…
->
pNext
 = 
∂
;

337 *
pLe·
 = 
pHód
;

338 
	}
}

348 
	$mîge_s‹t
(
time_d©a
 **
pHód
)

351 i‡(
NULL
 =*
pHód
 || NULL =(*pHód)->
pNext
) ;

354 
p_time_d©a
 
∂
, 
¥
;

355 
¥
 = 
	`gë_middÀ_poöãr
(*
pHód
);

356 
∂
 = *
pHód
;

359 
	`mîge_s‹t
(&
∂
);

360 
	`mîge_s‹t
(&
¥
);

361 
	`mîge
(&
∂
, 
¥
);

364 *
pHód
 = 
∂
;

367 
	}
}

378 
	$cmp
(c⁄° **
p1
, c⁄° **
p2
)

380 
p_time_d©a
 
p3
;

381 
p_time_d©a
 
p4
;

382 
p3
 = (
p_time_d©a
)(*
p1
);

383 
p4
 = (
p_time_d©a
)(*
p2
);

385  
p4
->
iTimes
 - 
p3
->iTimes;

386 
	}
}

	@
1
.
0
1
10
readlog.c
